@using StoneHammer.Systems
@inject CombatService CombatService
@implements IDisposable

@if (CombatService.IsFighting)
{
    <div class="combat-overlay">
        <!-- Top: Combat Log -->
        <div class="combat-log-box">
            @CombatService.CombatLog
        </div>

        <!-- Center: Scene is visible behind this UI -->

        <!-- Bottom: Control Panel -->
        <div class="combat-controls">
            <!-- Left: Command Menu -->
            <div class="combat-menu">
                <div class="combat-menu-title">COMMAND</div>
                <ul>
                    <li @onclick='() => Action("Attack")'>Attack</li>
                    <li @onclick='() => Action("Heal")'>Magic</li>
                    <li @onclick='() => Action("Defend")'>Defend</li>
                    <li @onclick='() => Action("Item")'>Item</li>
                    <li @onclick='() => Action("Run")'>Run</li>
                </ul>
            </div>

            <!-- Right: Status -->
            <div class="combat-status">
                <div class="status-row">
                    <span class="name">MASON</span>
                    <span class="hp">HP @CombatService.PlayerHP / @CombatService.PlayerMaxHP</span>
                </div>
                 <div class="status-row enemy">
                    <span class="name">@CombatService.CurrentEnemy.Name</span>
                    <span class="hp">HP @CombatService.CurrentEnemy.HP / @CombatService.CurrentEnemy.MaxHP</span>
                </div>
            </div>
        </div>
    </div>
}

@code {
    protected override void OnInitialized()
    {
        CombatService.OnStateChanged += StateHasChanged;
    }

    private async Task Action(string action)
    {
        await CombatService.PlayerAction(action);
    }

    public void Dispose()
    {
        CombatService.OnStateChanged -= StateHasChanged;
    }
}

<style>
    .combat-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none; /* Let clicks pass through generally, but re-enable for menus */
        z-index: 2000;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding: 20px;
        box-sizing: border-box;
        font-family: 'Courier New', Courier, monospace;
        font-weight: bold;
        color: white;
        text-shadow: 2px 2px #000;
    }

    .combat-log-box {
        background: linear-gradient(#000088, #000044);
        border: 4px solid white;
        border-radius: 8px;
        padding: 20px;
        width: 100%;
        font-size: 1.5rem;
        pointer-events: auto;
    }

    .combat-controls {
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
        width: 100%;
        pointer-events: auto;
    }

    .combat-menu {
        background: linear-gradient(#000088, #000044);
        border: 4px solid white;
        border-radius: 8px;
        padding: 15px;
        width: 250px;
    }

    .combat-menu-title {
        border-bottom: 2px solid white;
        margin-bottom: 10px;
        color: #ffff00;
    }

    .combat-menu ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .combat-menu li {
        padding: 5px 10px;
        cursor: pointer;
    }

    .combat-menu li:hover {
        background-color: rgba(255, 255, 255, 0.2);
        color: #ffff00;
    }

    .combat-menu li::before {
        content: "â–º"; /* Hand cursor */
        margin-right: 10px;
        opacity: 0;
    }
    .combat-menu li:hover::before {
        opacity: 1;
    }

    .combat-status {
        background: linear-gradient(#000088, #000044);
        border: 4px solid white;
        border-radius: 8px;
        padding: 15px;
        width: 400px;
    }

    .status-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 5px;
    }
    
    .status-row.enemy {
        color: #ff6666;
    }
</style>
